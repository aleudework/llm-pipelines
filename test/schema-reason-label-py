from pydantic import BaseModel
from typing import List
import lmstudio as lms
import pathlib
import json

# üìò 1. Defin√©r schema for output (f.eks. klassifikation)
class Classification(BaseModel):
    label: str      # √©t ord
    reason: str     # forklaring

# üß† 2. Load modellen √©n gang
model = lms.llm("meta-llama-3.1-8b-instruct")

# üì• 3. Inputtekster (kunne ogs√• komme fra en fil)
inputs = [
    "I love watching football on the weekends.",
    "The economy is struggling due to inflation.",
    "She painted a beautiful landscape."
]

# üì§ 4. Funktion der k√∏rer LLM med prompt og parser output
def classify(text: str) -> Classification:
    prompt = (
        f"Classify the following text into one word (like sports, finance, art).\n"
        f"Also explain why in 1-2 sentences.\n\n"
        f"Text: '{text}'\n"
        f"Respond as JSON with 'label' and 'reason'."
    )
    result = model.respond(prompt, response_format=Classification)
    return result

# üîÅ 5. K√∏r pipeline for alle input og gem resultat
results: List[Classification] = []

for text in inputs:
    output = classify(text)
    results.append(output)
    print(f"{text} ‚Üí {output}")
